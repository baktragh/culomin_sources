;
; File generated by cc65 v 2.18 - Git 08705a3
;
	.fopt		compiler,"cc65 v 2.18 - Git 08705a3"
	.setcpu		"6502"
	.smart		on
	.autoimport	on
	.case		on
	.debuginfo	off
	.importzp	sp, sreg, regsave, regbank
	.importzp	tmp1, tmp2, tmp3, tmp4, ptr1, ptr2, ptr3, ptr4
	.macpack	longbranch
	.forceimport	__STARTUP__
	.import		_CLM_DATA_CAVES
	.import		_CLM_DATA_CHARSET1
	.import		_CLM_DATA_CHARSET2
	.import		_CLM_DATA_CAVEDL
	.import		_CLM_DATA_PMGAREA
	.import		_CLM_DATA_CAVESCREEN
	.import		_CLM_DATA_STATUSBARSCREEN
	.import		_get_tv
	.import		_clrscr
	.import		_kbhit
	.import		_gotoxy
	.import		_cputcxy
	.import		_cputsxy
	.import		_cprintf
	.import		_cgetc
	.import		_cursor
	.import		_revers
	.import		_memcpy
	.import		_memset
	.export		_doGame
	.export		_paintElement
	.export		_paintCave
	.export		_rebuildCaveElementArray
	.export		_pmgInit
	.export		_setMinerPos
	.export		_repaintMiner
	.export		_delay
	.export		_adjustGameSpeed
	.export		_displayCongratulations
	.export		_displayGameOver
	.export		_displayReturnToMenuScreen
	.export		_setTextModeSettings
	.export		_displayMainMenu
	.export		_displayTrainingText
	.export		_displayGameSpeed
	.export		_displayStartingCave
	.import		_rmtAllStop
	.import		_rmtSuspend
	.import		_rmtResume
	.import		_rmtSetVBI
	.import		_rmtRestoreVBI
	.export		_playSongLine
	.import		_rmtPlaySongLine
	.export		_playSFX
	.import		_rmtPlaySFX
	.import		_asmReboot
	.export		_moveLeft
	.export		_moveRight
	.export		_moveUp
	.export		_moveDown
	.export		_jumpUp
	.export		_fallDown
	.export		_handleHighJump
	.export		_updateStatusBar
	.export		_checkTreasure
	.export		_checkDeath
	.export		_maxCaveReached
	.export		_startingCave
	.export		_dmactlStore
	.export		_lives
	.export		_currentCave
	.export		_diamondsInCave
	.export		_diamondsCollected
	.export		_caveDeath
	.export		_caveAllPicked
	.export		_stayHere
	.export		_gameOverType
	.export		_gameSpeed
	.export		_gameType
	.export		_menuDl1
	.export		_menuDl2
	.export		_x1
	.export		_y1
	.export		_i1
	.export		_i2
	.export		_z1
	.export		_caveElements
	.export		_caveBroken
	.export		_minerX
	.export		_minerY
	.export		_p0x
	.export		_p0y
	.export		_minerDataNormal
	.export		_minerDataJump
	.export		_trainingLiteral
	.export		_hijs
	.export		_hiJump
	.import		_mvDelay
	.import		_dliHandler
	.import		_colorStore1
	.import		_colorStore2
	.export		_minerData
	.export		_brokenSpeed
	.export		_hijumpSpeedA
	.export		_hijumpSpeedB
	.export		_controlDelay
	.export		_fallSpeed
	.import		_requestedSFXCode
	.import		_songLine
	.export		_passable
	.export		_notJump
	.export		_broken
	.export		_elem2CharMap
	.export		_main

.segment	"DATA"

_minerDataNormal:
	.byte	$3C
	.byte	$7E
	.byte	$5A
	.byte	$DB
	.byte	$FF
	.byte	$C3
	.byte	$66
	.byte	$3C
_minerDataJump:
	.byte	$3C
	.byte	$7E
	.byte	$5A
	.byte	$DB
	.byte	$FF
	.byte	$C3
	.byte	$7E
	.byte	$00
_trainingLiteral:
	.byte	$34
	.byte	$32
	.byte	$21
	.byte	$29
	.byte	$2E
	.byte	$29
	.byte	$2E
	.byte	$27
_minerData:
	.addr	_minerDataNormal
_passable:
	.byte	$01
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$01
	.byte	$00
	.byte	$00
	.byte	$01
	.byte	$01
	.byte	$01
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
_notJump:
	.byte	$01
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$01
	.byte	$01
	.byte	$01
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
_broken:
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$00
	.byte	$01
	.byte	$01
	.byte	$01
	.byte	$01
	.byte	$01
	.byte	$01
	.byte	$01
	.byte	$01
_elem2CharMap:
	.byte	$00
	.byte	$C0
	.byte	$C8
	.byte	$CA
	.byte	$C6
	.byte	$C4
	.byte	$DA
	.byte	$4E
	.byte	$C2
	.byte	$CC
	.byte	$54
	.byte	$56
	.byte	$58
	.byte	$E1
	.byte	$E3
	.byte	$E5
	.byte	$E7
	.byte	$E9
	.byte	$EB
	.byte	$ED
	.byte	$EF
	.byte	$50
	.byte	$52

.segment	"RODATA"

L07DC:
	.byte	$57,$68,$65,$6E,$20,$74,$68,$65,$20,$6D,$69,$6E,$65,$72,$20,$69
	.byte	$73,$20,$66,$61,$6C,$6C,$69,$6E,$67,$2C,$20,$68,$65,$20,$63,$61
	.byte	$6E,$20,$6D,$6F,$76,$65,$00
L0636:
	.byte	$20,$20,$20,$20,$20,$20,$20,$20,$20,$20,$42,$41,$48,$41,$20,$53
	.byte	$6F,$66,$74,$77,$61,$72,$65,$20,$32,$30,$32,$30,$20,$20,$20,$20
	.byte	$20,$20,$20,$20,$20,$20,$00
L0846:
	.byte	$50,$72,$65,$73,$73,$20,$53,$54,$41,$52,$54,$20,$74,$6F,$20,$72
	.byte	$65,$74,$75,$72,$6E,$20,$74,$6F,$20,$74,$68,$65,$20,$6D,$61,$69
	.byte	$6E,$20,$6D,$65,$6E,$75,$00
L0631:
	.byte	$20,$20,$20,$20,$20,$20,$20,$43,$55,$52,$53,$45,$20,$4F,$46,$20
	.byte	$54,$48,$45,$20,$20,$4C,$4F,$53,$54,$20,$4D,$49,$4E,$45,$52,$20
	.byte	$20,$20,$20,$20,$20,$20,$00
L081E:
	.byte	$54,$68,$65,$20,$6D,$69,$6E,$65,$72,$20,$63,$61,$6E,$20,$6A,$75
	.byte	$6D,$70,$20,$6F,$6E,$6C,$79,$20,$77,$68,$65,$6E,$20,$74,$68,$65
	.byte	$72,$65,$20,$69,$73,$00
L07B9:
	.byte	$55,$73,$65,$20,$6A,$6F,$79,$73,$74,$69,$63,$6B,$20,$69,$6E,$20
	.byte	$70,$6F,$72,$74,$20,$31,$20,$74,$6F,$20,$63,$6F,$6E,$74,$72,$6F
	.byte	$6C,$20,$74,$68,$65,$00
L083C:
	.byte	$4C,$6F,$6E,$67,$20,$6A,$75,$6D,$70,$20,$74,$6F,$20,$74,$68,$65
	.byte	$20,$6C,$65,$66,$74,$20,$6F,$72,$20,$74,$6F,$20,$74,$68,$65,$20
	.byte	$72,$69,$67,$68,$74,$00
L0725:
	.byte	$4E,$6F,$77,$20,$79,$6F,$75,$20,$73,$68,$6F,$75,$6C,$64,$20,$63
	.byte	$72,$65,$61,$74,$65,$20,$79,$6F,$75,$72,$20,$6F,$77,$6E,$20,$63
	.byte	$61,$76,$65,$73,$2E,$00
L0832:
	.byte	$6F,$72,$20,$74,$6F,$20,$74,$68,$65,$20,$72,$69,$67,$68,$74,$20
	.byte	$6F,$6E,$63,$65,$20,$64,$75,$72,$69,$6E,$67,$20,$74,$68,$65,$20
	.byte	$6A,$75,$6D,$70,$00
L082D:
	.byte	$48,$69,$67,$68,$20,$6A,$75,$6D,$70,$20,$2D,$20,$59,$6F,$75,$20
	.byte	$63,$61,$6E,$20,$6D,$6F,$76,$65,$20,$74,$6F,$20,$74,$68,$65,$20
	.byte	$6C,$65,$66,$74,$00
L0659:
	.byte	$47,$75,$69,$64,$65,$20,$74,$68,$65,$20,$6D,$69,$6E,$65,$72,$20
	.byte	$74,$68,$72,$6F,$75,$67,$68,$20,$31,$33,$20,$64,$61,$6E,$67,$65
	.byte	$72,$6F,$75,$73,$00
L07D2:
	.byte	$4A,$6F,$79,$73,$74,$69,$63,$6B,$20,$64,$6F,$77,$6E,$20,$20,$2D
	.byte	$20,$4D,$6F,$76,$65,$20,$64,$6F,$77,$6E,$20,$28,$6C,$61,$64,$64
	.byte	$65,$72,$29,$00
L07C8:
	.byte	$4A,$6F,$79,$73,$74,$69,$63,$6B,$20,$72,$69,$67,$68,$74,$20,$2D
	.byte	$20,$4D,$6F,$76,$65,$20,$74,$6F,$20,$74,$68,$65,$20,$72,$69,$67
	.byte	$68,$74,$00
L065E:
	.byte	$63,$61,$76,$65,$73,$2E,$20,$41,$76,$6F,$69,$64,$20,$6F,$62,$73
	.byte	$74,$61,$63,$6C,$65,$73,$20,$61,$6E,$64,$20,$63,$6F,$6C,$6C,$65
	.byte	$63,$74,$00
L07CD:
	.byte	$4A,$6F,$79,$73,$74,$69,$63,$6B,$20,$75,$70,$20,$20,$20,$20,$2D
	.byte	$20,$4D,$6F,$76,$65,$20,$75,$70,$20,$28,$6C,$61,$64,$64,$65,$72
	.byte	$29,$00
L07C3:
	.byte	$4A,$6F,$79,$73,$74,$69,$63,$6B,$20,$6C,$65,$66,$74,$20,$20,$2D
	.byte	$20,$4D,$6F,$76,$65,$20,$74,$6F,$20,$74,$68,$65,$20,$6C,$65,$66
	.byte	$74,$00
L07E1:
	.byte	$74,$6F,$20,$74,$68,$65,$20,$6C,$65,$66,$74,$20,$61,$6E,$64,$20
	.byte	$74,$6F,$20,$74,$68,$65,$20,$72,$69,$67,$68,$74,$20,$6F,$6E,$63
	.byte	$65,$00
L07E6:
	.byte	$54,$68,$65,$20,$6D,$69,$6E,$65,$72,$20,$64,$69,$65,$73,$20,$77
	.byte	$68,$65,$6E,$20,$68,$65,$20,$66,$61,$6C,$6C,$73,$20,$74,$6F,$6F
	.byte	$20,$00
L07F0:
	.byte	$41,$76,$6F,$69,$64,$20,$73,$70,$69,$6B,$65,$73,$20,$2D,$20,$74
	.byte	$68,$65,$20,$6D,$69,$6E,$65,$72,$20,$63,$61,$6E,$20,$6A,$75,$6D
	.byte	$70,$00
L0720:
	.byte	$54,$68,$61,$6E,$6B,$20,$79,$6F,$75,$20,$66,$6F,$72,$20,$70,$6C
	.byte	$61,$79,$69,$6E,$67,$20,$74,$68,$69,$73,$20,$67,$61,$6D,$65,$2E
	.byte	$00
L07D7:
	.byte	$54,$68,$65,$20,$6D,$69,$6E,$65,$72,$20,$69,$73,$20,$61,$66,$66
	.byte	$65,$63,$74,$65,$64,$20,$62,$79,$20,$67,$72,$61,$76,$69,$74,$79
	.byte	$00
L0841:
	.byte	$50,$72,$65,$73,$73,$20,$4F,$50,$54,$49,$4F,$4E,$20,$74,$6F,$20
	.byte	$63,$6F,$6D,$6D,$69,$74,$20,$73,$75,$69,$63,$69,$64,$65,$00
L07A6:
	.byte	$52,$65,$74,$75,$72,$6E,$69,$6E,$67,$20,$74,$6F,$20,$74,$68,$65
	.byte	$20,$6D,$61,$69,$6E,$20,$6D,$65,$6E,$75,$20,$2E,$2E,$2E,$00
L0837:
	.byte	$46,$49,$52,$45,$20,$2B,$20,$4A,$6F,$79,$73,$74,$69,$63,$6B,$20
	.byte	$6C,$65,$66,$74,$20,$6F,$72,$20,$72,$69,$67,$68,$74,$00
L0823:
	.byte	$61,$20,$72,$6F,$63,$6B,$20,$6F,$72,$20,$61,$20,$6C,$61,$64,$64
	.byte	$65,$72,$20,$75,$6E,$64,$65,$72,$20,$68,$69,$6D,$00
L0716:
	.byte	$54,$68,$65,$20,$63,$75,$72,$73,$65,$20,$6F,$66,$20,$74,$68,$65
	.byte	$20,$6C,$6F,$73,$74,$20,$6D,$69,$6E,$65,$72,$00
L0663:
	.byte	$61,$6C,$6C,$20,$64,$69,$61,$6D,$6F,$6E,$64,$73,$20,$69,$6E,$20
	.byte	$65,$61,$63,$68,$20,$63,$61,$76,$65,$2E,$00
L0859:
	.byte	$74,$6F,$20,$65,$6E,$74,$65,$72,$20,$74,$68,$65,$20,$74,$72,$61
	.byte	$69,$6E,$69,$6E,$67,$20,$63,$61,$76,$65,$00
L0814:
	.byte	$54,$6F,$20,$63,$6F,$75,$6E,$74,$65,$72,$61,$63,$74,$20,$74,$68
	.byte	$65,$20,$67,$72,$61,$76,$69,$74,$79,$2C,$00
L069B:
	.byte	$74,$6F,$20,$74,$6F,$67,$67,$6C,$65,$20,$67,$61,$6D,$65,$20,$73
	.byte	$70,$65,$65,$64,$3A,$00
L068D:
	.byte	$74,$6F,$20,$73,$65,$74,$20,$73,$74,$61,$72,$74,$69,$6E,$67,$20
	.byte	$63,$61,$76,$65,$3A,$00
L0819	:=	L07F0+15
L0828:
	.byte	$46,$49,$52,$45,$20,$2B,$20,$4A,$6F,$79,$73,$74,$69,$63,$6B,$20
	.byte	$75,$70,$00
L06A9:
	.byte	$74,$6F,$20,$73,$74,$61,$72,$74,$20,$74,$72,$61,$69,$6E,$69,$6E
	.byte	$67,$00
L0711:
	.byte	$43,$6F,$6E,$67,$72,$61,$74,$75,$6C,$61,$74,$69,$6F,$6E,$73,$20
	.byte	$21,$00
L071B:
	.byte	$68,$61,$73,$20,$62,$65,$65,$6E,$20,$62,$72,$6F,$6B,$65,$6E,$2E
	.byte	$00
L0808:
	.byte	$66,$6F,$72,$20,$6E,$65,$78,$74,$20,$70,$61,$67,$65,$00
L0672:
	.byte	$74,$6F,$20,$73,$74,$61,$72,$74,$20,$67,$61,$6D,$65,$00
L076E:
	.byte	$47,$41,$4D,$45,$20,$49,$53,$20,$4F,$56,$45,$52,$00
L078A:
	.byte	$74,$6F,$20,$63,$6F,$6E,$74,$69,$6E,$75,$65,$00
L0750	:=	L078A+0
L07F5:
	.byte	$6F,$76,$65,$72,$20,$74,$68,$65,$6D,$00
L06BA:
	.byte	$4E,$4F,$52,$4D,$41,$4C,$00
L06C0:
	.byte	$20,$20,$53,$4C,$4F,$57,$00
L07EB:
	.byte	$64,$65,$65,$70,$6C,$79,$00
L066D:
	.byte	$50,$72,$65,$73,$73,$00
L084B	:=	L066D+0
L07FA	:=	L066D+0
L0742	:=	L066D+0
L077C	:=	L066D+0
L07BE	:=	L0716+22
L0668:
	.byte	$76,$31,$2E,$35,$00
L0749:
	.byte	$46,$49,$52,$45,$00
L0679	:=	L0749+0
L0801	:=	L0749+0
L0852	:=	L0749+0
L06FA:
	.byte	$25,$30,$32,$64,$00
L0783	:=	L0749+0
L06A0:
	.byte	$4A,$53,$00
L0680	:=	L06A0+0
L0692	:=	L06A0+0

.segment	"BSS"

_maxCaveReached:
	.res	1,$00
_startingCave:
	.res	1,$00
_dmactlStore:
	.res	1,$00
_lives:
	.res	1,$00
_currentCave:
	.res	1,$00
_diamondsInCave:
	.res	1,$00
_diamondsCollected:
	.res	1,$00
_caveDeath:
	.res	1,$00
_caveAllPicked:
	.res	1,$00
_stayHere:
	.res	1,$00
_gameOverType:
	.res	1,$00
_gameSpeed:
	.res	1,$00
_gameType:
	.res	1,$00
_menuDl1:
	.res	1,$00
_menuDl2:
	.res	1,$00
_x1:
	.res	1,$00
_y1:
	.res	1,$00
_i1:
	.res	2,$00
_i2:
	.res	2,$00
_z1:
	.res	1,$00
_caveElements:
	.res	440,$00
_caveBroken:
	.res	440,$00
_minerX:
	.res	1,$00
_minerY:
	.res	1,$00
_p0x:
	.res	2,$00
_p0y:
	.res	2,$00
_hijs:
	.res	1,$00
_hiJump:
	.res	1,$00
_brokenSpeed:
	.res	1,$00
_hijumpSpeedA:
	.res	1,$00
_hijumpSpeedB:
	.res	1,$00
_controlDelay:
	.res	1,$00
_fallSpeed:
	.res	1,$00

; ---------------------------------------------------------------
; void __near__ doGame (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_doGame: near

.segment	"CODE"

	ldy     #$0E
	jsr     subysp
	lda     #$00
	sta     $022F
	lda     #$02
	jsr     pusha0
	jsr     _delay
	lda     #<(_CLM_DATA_CAVEDL)
	sta     $0230
	ldx     #>(_CLM_DATA_CAVEDL)
	stx     $0231
	lda     _gameType
	bne     L088F
	lda     _startingCave
	jmp     L088B
L088F:	lda     #$0D
L088B:	sta     _currentCave
	lda     #$04
	sta     _lives
	lda     #<(_dliHandler)
	ldx     #>(_dliHandler)
	jsr     stax0sp
	sta     $0200
	jsr     ldax0sp
	stx     $0201
	lda     #$C0
	sta     $D40E
L0890:	lda     #$00
L08B0:	sta     $022F
	lda     _currentCave
	jsr     pusha
	jsr     _rebuildCaveElementArray
	lda     #$00
	sta     _diamondsCollected
	lda     _currentCave
	and     #$03
	cmp     #$02
	bcs     L01A0
	jsr     _get_tv
	cmp     #$01
	bne     L01A4
	lda     #$0C
	sta     $02C5
	lda     #$86
	sta     $02C6
	lda     #$F2
	sta     $02C4
	lda     #$F4
	jmp     L088C
L01A4:	lda     #$0C
	sta     $02C5
	lda     #$96
	sta     $02C6
	lda     #$32
	sta     $02C4
	lda     #$34
	jmp     L088C
L01A0:	jsr     _get_tv
	cmp     #$01
	bne     L01D0
	lda     #$0C
	sta     $02C5
	lda     #$B8
	sta     $02C6
	lda     #$54
	sta     $02C4
	lda     #$66
	jmp     L088C
L01D0:	lda     #$0C
	sta     $02C5
	lda     #$D8
	sta     $02C6
	lda     #$54
	sta     $02C4
	lda     #$56
L088C:	sta     $02C7
	lda     $02C5
	sta     _colorStore1
	lda     $02C6
	sta     _colorStore2
	jsr     _paintCave
	jsr     _updateStatusBar
	lda     #>(_minerDataNormal)
	sta     _minerData+1
	lda     #<(_minerDataNormal)
	sta     _minerData
	lda     _minerX
	jsr     pusha
	lda     _minerY
	jsr     pusha
	jsr     _setMinerPos
	lda     #$01
	sta     _stayHere
	lda     #$00
	ldy     #$08
	sta     (sp),y
	sta     _caveDeath
	sta     _caveAllPicked
	ldy     #$02
	sta     (sp),y
	ldy     #$07
	sta     (sp),y
	dey
	sta     (sp),y
	dey
	sta     (sp),y
	ldy     #$03
	sta     (sp),y
	lda     #$01
	ldy     #$0B
	sta     (sp),y
	lda     #$3E
	sta     $022F
	jmp     L02CD
L0226:	lda     $D01F
	cmp     #$07
	beq     L0892
	cmp     #$06
	bne     L0891
	lda     #$00
	sta     _stayHere
	lda     #$01
	ldy     #$03
	sta     (sp),y
	lda     #$00
	sta     $004D
	jmp     L08A7
L0891:	lda     $D01F
	cmp     #$03
	bne     L0892
	lda     #$01
	sta     _caveDeath
	lda     #$00
	sta     _stayHere
	sta     $004D
	jmp     L0227
L0892:	lda     _minerX
	jsr     pusha0
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveElements)
	sta     ptr1
	txa
	adc     #>(_caveElements)
	sta     ptr1+1
	ldy     _minerY
	lda     (ptr1),y
	ldy     #$0A
	sta     (sp),y
	lda     _minerX
	jsr     pusha0
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveElements)
	sta     ptr1
	txa
	adc     #>(_caveElements)
	sta     ptr1+1
	ldx     #$00
	lda     _minerY
	jsr     incax1
	clc
	adc     ptr1
	sta     ptr1
	txa
	adc     ptr1+1
	sta     ptr1+1
	ldy     #$00
	lda     (ptr1),y
	ldy     #$0B
	sta     (sp),y
	tay
	lda     _passable,y
	cmp     #$01
	bne     L0250
	ldy     #$0A
	lda     (sp),y
	cmp     #$07
	beq     L0250
	iny
	lda     (sp),y
	cmp     #$07
	beq     L0250
	ldy     #$09
	lda     (sp),y
	cmp     $0014
	beq     L0268
	dey
	lda     (sp),y
	clc
	adc     #$01
	sta     (sp),y
	lda     $0014
	iny
	sta     (sp),y
	dey
	lda     (sp),y
	cmp     _fallSpeed
	bne     L0268
	jsr     _fallDown
	ldy     #$07
	lda     (sp),y
	clc
	adc     #$01
	sta     (sp),y
	jsr     _checkDeath
	lda     #$00
	ldy     #$08
	sta     (sp),y
	dey
	lda     (sp),y
	cmp     #$07
	bcc     L0268
	lda     #$00
	sta     _stayHere
	lda     #$01
	sta     _caveDeath
	jmp     L02CD
L0268:	ldy     #$06
	lda     (sp),y
	ora     #$04
	sta     (sp),y
	lda     #$00
	jmp     L08C2
L0250:	ldy     #$06
	lda     (sp),y
	and     #$03
	beq     L0896
	lda     #$02
	dey
	sta     (sp),y
	lda     #$00
L0896:	ldy     #$08
	sta     (sp),y
	dey
	sta     (sp),y
L08C2:	dey
	sta     (sp),y
	ldy     #$0B
	lda     (sp),y
	tay
	lda     _broken,y
	cmp     #$01
	jne     L02A8
	lda     _minerY
	clc
	adc     #$01
	sta     _y1
	ldy     #$04
	lda     (sp),y
	cmp     $0014
	beq     L0897
	lda     _minerX
	jsr     pusha0
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveBroken)
	tay
	txa
	adc     #>(_caveBroken)
	tax
	tya
	clc
	adc     _y1
	bcc     L0880
	inx
L0880:	jsr     pushax
	sta     ptr1
	stx     ptr1+1
	ldy     #$00
	lda     (ptr1),y
	clc
	adc     #$01
	jsr     staspidx
	lda     $0014
	ldy     #$04
	sta     (sp),y
L0897:	lda     _minerX
	jsr     pusha0
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveBroken)
	sta     ptr1
	txa
	adc     #>(_caveBroken)
	sta     ptr1+1
	ldy     _y1
	lda     (ptr1),y
	cmp     _brokenSpeed
	jne     L02A8
	lda     _minerX
	jsr     pusha0
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveBroken)
	tay
	txa
	adc     #>(_caveBroken)
	tax
	tya
	clc
	adc     _y1
	bcc     L0882
	inx
L0882:	sta     ptr1
	stx     ptr1+1
	lda     #$00
	tay
	sta     (ptr1),y
	ldy     #$0B
	lda     (sp),y
	cmp     #$14
	bcs     L0898
	lda     _minerX
	jsr     pusha0
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveElements)
	tay
	txa
	adc     #>(_caveElements)
	tax
	tya
	clc
	adc     _y1
	bcc     L0883
	inx
L0883:	jsr     pushax
	sta     ptr1
	stx     ptr1+1
	ldy     #$00
	lda     (ptr1),y
	clc
	adc     #$01
	jsr     staspidx
	jmp     L08C1
L0898:	lda     _minerX
	jsr     pusha0
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveElements)
	tay
	txa
	adc     #>(_caveElements)
	tax
	tya
	clc
	adc     _y1
	bcc     L0885
	inx
L0885:	sta     ptr1
	stx     ptr1+1
	lda     #$00
	tay
	sta     (ptr1),y
L08C1:	lda     _minerX
	jsr     pusha
	lda     _y1
	jsr     pusha
	lda     _minerX
	jsr     pusha0
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveElements)
	sta     ptr1
	txa
	adc     #>(_caveElements)
	sta     ptr1+1
	ldy     _y1
	lda     (ptr1),y
	jsr     pusha
	jsr     _paintElement
L02A8:	ldy     #$0B
	lda     (sp),y
	cmp     #$06
	bne     L0899
	lda     _minerX
	jsr     pusha0
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveElements)
	sta     ptr1
	txa
	adc     #>(_caveElements)
	sta     ptr1+1
	ldx     #$00
	lda     _minerY
	jsr     incax1
	clc
	adc     ptr1
	sta     ptr1
	txa
	adc     ptr1+1
	sta     ptr1+1
	lda     #$00
	tay
	sta     (ptr1),y
	lda     _minerX
	jsr     pusha
	lda     _minerY
	clc
	adc     #$01
	jsr     pusha
	lda     #$00
	jsr     pusha
	jsr     _paintElement
L0899:	lda     _mvDelay
	jne     L02CD
	lda     $0278
	ldy     #$0D
	sta     (sp),y
	lda     $0284
	dey
	sta     (sp),y
	iny
	lda     (sp),y
	cmp     #$06
	beq     L02D0
	cmp     #$07
	beq     L02D0
	cmp     #$0A
	jeq     L0321
	cmp     #$0B
	jeq     L0321
	cmp     #$0D
	jeq     L0372
	cmp     #$0E
	jeq     L037C
	jmp     L08A6
L02D0:	dey
	lda     (sp),y
	bne     L02D4
	dey
	lda     (sp),y
	tay
	lda     _notJump,y
	bne     L02D4
	lda     #$12
	jsr     pusha
	jsr     _playSFX
	lda     #$00
	sta     $004D
	lda     #>(_minerDataJump)
	sta     _minerData+1
	lda     #<(_minerDataJump)
	sta     _minerData
	lda     #$00
	ldy     #$07
	sta     (sp),y
	jsr     _jumpUp
	tax
	jne     L02CD
	lda     #$04
	jsr     pusha0
	jsr     _delay
	jsr     _jumpUp
	tax
	jne     L02CD
	lda     #$04
	jsr     pusha0
	jsr     _delay
	jsr     _moveRight
	lda     #$04
	jsr     pusha0
	jsr     _delay
	jsr     _moveRight
	lda     #$04
	jsr     pusha0
	jsr     _delay
	jsr     _moveRight
	lda     #$04
	jsr     pusha0
	jsr     _delay
	jsr     _checkDeath
	lda     #>(_minerDataNormal)
	sta     _minerData+1
	lda     #<(_minerDataNormal)
	sta     _minerData
	jsr     _repaintMiner
	jmp     L02CD
L02D4:	ldy     #$06
	lda     (sp),y
	and     #$04
	cmp     #$04
	bne     L0301
	lda     (sp),y
	and     #$02
	bne     L089E
	jsr     _moveRight
	tax
	beq     L089F
	ldy     #$06
	lda     (sp),y
	ora     #$02
	sta     (sp),y
	jmp     L089E
L0301:	dey
	lda     (sp),y
	bne     L089D
	jsr     _moveRight
	jmp     L089E
L089D:	lda     (sp),y
	sec
	sbc     #$01
	sta     (sp),y
	lda     _controlDelay
	sta     _mvDelay
L089E:	lda     #$00
L089F:	sta     $004D
	jsr     _checkDeath
	jmp     L02CD
L0321:	dey
	lda     (sp),y
	bne     L0325
	dey
	lda     (sp),y
	tay
	lda     _notJump,y
	bne     L0325
	lda     #$12
	jsr     pusha
	jsr     _playSFX
	lda     #$00
	sta     $004D
	lda     #>(_minerDataJump)
	sta     _minerData+1
	lda     #<(_minerDataJump)
	sta     _minerData
	lda     #$00
	ldy     #$07
	sta     (sp),y
	jsr     _jumpUp
	tax
	jne     L02CD
	lda     #$04
	jsr     pusha0
	jsr     _delay
	jsr     _jumpUp
	tax
	jne     L02CD
	lda     #$04
	jsr     pusha0
	jsr     _delay
	jsr     _moveLeft
	lda     #$04
	jsr     pusha0
	jsr     _delay
	jsr     _moveLeft
	lda     #$04
	jsr     pusha0
	jsr     _delay
	jsr     _moveLeft
	lda     #$04
	jsr     pusha0
	jsr     _delay
	jsr     _checkDeath
	lda     #>(_minerDataNormal)
	sta     _minerData+1
	lda     #<(_minerDataNormal)
	sta     _minerData
	jsr     _repaintMiner
	jmp     L02CD
L0325:	ldy     #$06
	lda     (sp),y
	and     #$04
	cmp     #$04
	bne     L0352
	lda     (sp),y
	and     #$01
	bne     L08A4
	jsr     _moveLeft
	tax
	beq     L08A5
	ldy     #$06
	lda     (sp),y
	ora     #$01
	sta     (sp),y
	jmp     L08A4
L0352:	dey
	lda     (sp),y
	bne     L08A3
	jsr     _moveLeft
	jmp     L08A4
L08A3:	lda     (sp),y
	sec
	sbc     #$01
	sta     (sp),y
	lda     _controlDelay
	sta     _mvDelay
L08A4:	lda     #$00
L08A5:	sta     $004D
	jsr     _checkDeath
	jmp     L02CD
L0372:	jsr     _moveDown
	lda     #$00
	sta     $004D
	jsr     _checkDeath
	jmp     L02CD
L037C:	dey
	lda     (sp),y
	bne     L037D
	dey
	lda     (sp),y
	tay
	lda     _notJump,y
	bne     L02CD
	ldy     #$07
	sta     (sp),y
	lda     #$12
	jsr     pusha
	jsr     _playSFX
	lda     #$00
	sta     $004D
	jsr     _handleHighJump
	jmp     L02CD
L037D:	jsr     _moveUp
	lda     #$00
	sta     $004D
	jsr     _checkDeath
	jmp     L02CD
L08A6:	lda     #$00
	ldy     #$05
	sta     (sp),y
	sta     _mvDelay
L02CD:	lda     _stayHere
	jne     L0226
L0227:	ldy     #$03
L08A7:	lda     (sp),y
	beq     L039A
	lda     #$F8
	jsr     pusha
	lda     #$20
	jsr     pusha
	jsr     _setMinerPos
	lda     #$03
	sta     _gameOverType
	jmp     L0194
L039A:	lda     _caveAllPicked
	beq     L03A2
	lda     _gameType
	cmp     #$01
	bne     L08A8
	lda     #$F8
	jsr     pusha
	lda     #$20
	jsr     pusha
	jsr     _setMinerPos
	lda     #$03
	sta     _gameOverType
	jmp     L0194
L08A8:	inc     _currentCave
	lda     _currentCave
	cmp     #$0D
	bne     L08A9
	lda     #$F8
	jsr     pusha
	lda     #$20
	jsr     pusha
	jsr     _setMinerPos
	lda     #$02
	sta     _gameOverType
	jmp     L0194
L08A9:	lda     _currentCave
	sec
	sbc     _maxCaveReached
	bcc     L03B8
	beq     L03B8
	lda     _currentCave
	sta     _maxCaveReached
L03B8:	lda     #$0C
	jsr     pusha
	jsr     _playSFX
	jmp     L0890
L03A2:	lda     _caveDeath
	jeq     L08B0
	ldy     #$06
	lda     (sp),y
	and     #$04
	cmp     #$04
	bne     L03C8
	jmp     L08AB
L08AA:	inc     _minerY
	lda     _minerX
	jsr     pusha
	lda     _minerY
	jsr     pusha
	jsr     _setMinerPos
	lda     #$03
	jsr     pusha0
	jsr     _delay
L08AB:	lda     _minerY
	cmp     #$16
	bcs     L03C8
	lda     _minerX
	jsr     pusha0
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveElements)
	sta     ptr1
	txa
	adc     #>(_caveElements)
	sta     ptr1+1
	ldx     #$00
	lda     _minerY
	jsr     incax1
	clc
	adc     ptr1
	sta     ptr1
	txa
	adc     ptr1+1
	sta     ptr1+1
	ldy     #$00
	lda     (ptr1),y
	beq     L08AA
L03C8:	lda     #$F8
	jsr     pusha
	lda     #$20
	jsr     pusha
	jsr     _setMinerPos
	lda     _minerX
	jsr     pusha
	lda     _minerY
	jsr     pusha
	lda     #$15
	jsr     pusha
	jsr     _paintElement
	lda     #$0E
	jsr     pusha
	jsr     _playSFX
	lda     #$0F
	jsr     pusha0
	jsr     _delay
	lda     _minerX
	jsr     pusha
	lda     _minerY
	jsr     pusha
	lda     #$16
	jsr     pusha
	jsr     _paintElement
	lda     #$0F
	jsr     pusha0
	jsr     _delay
	lda     _minerX
	jsr     pusha
	lda     _minerY
	jsr     pusha
	lda     #$15
	jsr     pusha
	jsr     _paintElement
	lda     #$05
	jsr     pusha0
	jsr     _delay
	lda     _lives
	bne     L08AE
	lda     #$01
	sta     _gameOverType
	jmp     L0194
L08AE:	dec     _lives
	jmp     L0890
L0194:	ldy     #$0E
	jmp     addysp

.endproc

; ---------------------------------------------------------------
; void __near__ paintElement (unsigned char, unsigned char, unsigned char)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_paintElement: near

.segment	"CODE"

	ldy     #$01
	lda     (sp),y
	jsr     pusha0
	lda     #$28
	jsr     tosumula0
	clc
	adc     #<(_CLM_DATA_CAVESCREEN)
	sta     ptr1
	txa
	adc     #>(_CLM_DATA_CAVESCREEN)
	sta     ptr1+1
	ldx     #$00
	ldy     #$02
	lda     (sp),y
	asl     a
	bcc     L08C4
	inx
	clc
L08C4:	adc     ptr1
	sta     _i2
	txa
	adc     ptr1+1
	sta     _i2+1
	ldy     #$00
	lda     (sp),y
	tay
	lda     _elem2CharMap,y
	sta     _z1
	lda     _i2+1
	sta     ptr1+1
	lda     _i2
	sta     ptr1
	lda     _z1
	ldy     #$00
	sta     (ptr1),y
	lda     _i2
	ldx     _i2+1
	jsr     incax1
	sta     ptr1
	stx     ptr1+1
	lda     _z1
	clc
	adc     #$01
	sta     (ptr1),y
	jmp     incsp3

.endproc

; ---------------------------------------------------------------
; void __near__ paintCave (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_paintCave: near

.segment	"CODE"

	lda     #$00
	sta     _y1
L08C6:	lda     _y1
	cmp     #$16
	bcs     L040E
	lda     #$00
	sta     _x1
L08C7:	lda     _x1
	cmp     #$14
	bcs     L08C8
	jsr     pusha
	lda     _y1
	jsr     pusha
	lda     _x1
	jsr     pusha0
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveElements)
	sta     ptr1
	txa
	adc     #>(_caveElements)
	sta     ptr1+1
	ldy     _y1
	lda     (ptr1),y
	jsr     pusha
	jsr     _paintElement
	inc     _x1
	jmp     L08C7
L08C8:	inc     _y1
	jmp     L08C6
L040E:	rts

.endproc

; ---------------------------------------------------------------
; void __near__ rebuildCaveElementArray (unsigned char)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_rebuildCaveElementArray: near

.segment	"CODE"

	jsr     decsp2
	jsr     push0
	jsr     decsp4
	ldy     #$08
	lda     (sp),y
	and     #$01
	beq     L0426
	lda     #>(_CLM_DATA_CHARSET2)
	jmp     L08CB
L0426:	lda     #>(_CLM_DATA_CHARSET1)
L08CB:	sta     $02F4
	lda     #<(_CLM_DATA_CAVES)
	ldx     #>(_CLM_DATA_CAVES)
	ldy     #$02
	jsr     staxysp
	ldy     #$02
	jsr     staxysp
	ldy     #$08
	lda     (sp),y
	jsr     pusha0
	lda     #$DE
	jsr     tosumula0
	ldy     #$02
	jsr     addeqysp
	lda     #$00
	sta     _diamondsInCave
	ldy     #$03
	jsr     ldaxysp
	sta     ptr1
	stx     ptr1+1
	ldy     #$00
	lda     (ptr1),y
	sta     _minerY
	ldy     #$03
	jsr     ldaxysp
	jsr     incax1
	ldy     #$02
	jsr     staxysp
	sta     ptr1
	stx     ptr1+1
	ldy     #$00
	lda     (ptr1),y
	sta     _minerX
	ldy     #$03
	jsr     ldaxysp
	jsr     incax1
	ldy     #$02
	jsr     staxysp
	lda     #$00
	tay
L08D1:	sta     (sp),y
	cmp     #$16
	jcs     L0448
	tya
	iny
L08CC:	sta     (sp),y
	cmp     #$14
	jcs     L0449
	ldy     #$03
	jsr     ldaxysp
	sta     ptr1
	stx     ptr1+1
	ldy     #$00
	lda     (ptr1),y
	lsr     a
	lsr     a
	lsr     a
	lsr     a
	ldy     #$06
	sta     (sp),y
	ldy     #$03
	jsr     ldaxysp
	sta     ptr1
	stx     ptr1+1
	ldy     #$00
	lda     (ptr1),y
	and     #$0F
	ldy     #$07
	sta     (sp),y
	ldx     #$00
	txa
L08D2:	ldy     #$04
	jsr     staxysp
	cmp     #$02
	txa
	sbc     #$00
	bvc     L0469
	eor     #$80
L0469:	bpl     L0463
	lda     #$06
	jsr     leaa0sp
	ldy     #$04
	clc
	adc     (sp),y
	sta     ptr1
	txa
	iny
	adc     (sp),y
	sta     ptr1+1
	ldy     #$00
	lda     (ptr1),y
	cmp     #$0E
	beq     L08CF
	cmp     #$0F
	beq     L047A
	jmp     L0464
L08CF:	inc     _diamondsInCave
	lda     #$06
	jsr     leaa0sp
	ldy     #$04
	clc
	adc     (sp),y
	pha
	txa
	iny
	adc     (sp),y
	tax
	pla
	jsr     pushax
	lda     _diamondsInCave
	jsr     pusha0
	lda     #$03
	jsr     tosumoda0
	ldy     #$0A
	jsr     incaxy
	ldy     #$00
	jsr     staspidx
	jmp     L0464
L047A:	lda     #$06
	jsr     leaa0sp
	ldy     #$04
	clc
	adc     (sp),y
	sta     ptr1
	txa
	iny
	adc     (sp),y
	sta     ptr1+1
	lda     #$0D
	ldy     #$00
	sta     (ptr1),y
L0464:	ldy     #$05
	jsr     ldaxysp
	jsr     incax1
	jmp     L08D2
L0463:	ldy     #$01
	lda     (sp),y
	jsr     pusha0
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveElements)
	sta     ptr1
	txa
	adc     #>(_caveElements)
	sta     ptr1+1
	ldy     #$00
	lda     (sp),y
	clc
	adc     ptr1
	ldx     ptr1+1
	bcc     L08C9
	inx
L08C9:	sta     ptr1
	stx     ptr1+1
	ldy     #$06
	lda     (sp),y
	ldy     #$00
	sta     (ptr1),y
	iny
	ldx     #$00
	lda     (sp),y
	jsr     incax1
	jsr     pushax
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveElements)
	sta     ptr1
	txa
	adc     #>(_caveElements)
	sta     ptr1+1
	ldy     #$00
	lda     (sp),y
	clc
	adc     ptr1
	ldx     ptr1+1
	bcc     L08CA
	inx
L08CA:	sta     ptr1
	stx     ptr1+1
	ldy     #$07
	lda     (sp),y
	ldy     #$00
	sta     (ptr1),y
	ldy     #$03
	jsr     ldaxysp
	jsr     incax1
	ldy     #$02
	jsr     staxysp
	ldy     #$01
	clc
	lda     #$02
	adc     (sp),y
	jmp     L08CC
L0449:	dey
	lda     (sp),y
	clc
	adc     #$01
	jmp     L08D1
L0448:	lda     #<(_caveBroken)
	ldx     #>(_caveBroken)
	jsr     pushax
	ldx     #$01
	lda     #$B8
	jsr     __bzero
	ldy     #$09
	jmp     addysp

.endproc

; ---------------------------------------------------------------
; void __near__ pmgInit (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_pmgInit: near

.segment	"CODE"

	ldx     #>(_CLM_DATA_PMGAREA)
	stx     $D407
	lda     #$3E
	sta     $022F
	lda     #<(_CLM_DATA_PMGAREA)
	ldx     #>(_CLM_DATA_PMGAREA)
	jsr     pushax
	ldx     #$08
	lda     #$00
	jsr     __bzero
	lda     #$02
	sta     $D01D
	jsr     _get_tv
	cmp     #$01
	bne     L04A4
	lda     #$A8
	jmp     L08D3
L04A4:	lda     #$C8
L08D3:	sta     $02C0
	lda     #$00
	sta     _p0x
	sta     _p0x+1
	lda     _p0x
	sta     $D000
	lda     #$00
	sta     _p0y
	sta     _p0y+1
	rts

.endproc

; ---------------------------------------------------------------
; void __near__ setMinerPos (unsigned char, unsigned char)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_setMinerPos: near

.segment	"CODE"

	ldy     #$01
	ldx     #$00
	lda     (sp),y
	jsr     aslax3
	ldy     #$30
	jsr     incaxy
	sta     _p0x
	stx     _p0x+1
	lda     _p0y
	ldx     _p0y+1
	jsr     pushax
	lda     #<(_CLM_DATA_PMGAREA)
	ldx     #>(_CLM_DATA_PMGAREA)
	jsr     swapstk
	jsr     tosaddax
	sta     ptr1
	stx     ptr1+1
	lda     #$00
	clc
	adc     ptr1
	pha
	lda     #$04
	adc     ptr1+1
	tax
	pla
	jsr     pushax
	ldx     #$00
	lda     #$08
	jsr     __bzero
	ldx     #$00
	lda     (sp,x)
	jsr     aslax3
	ldy     #$20
	jsr     incaxy
	sta     _p0y
	stx     _p0y+1
	lda     _p0x
	sta     $D000
	lda     _p0y
	ldx     _p0y+1
	jsr     pushax
	lda     #<(_CLM_DATA_PMGAREA)
	ldx     #>(_CLM_DATA_PMGAREA)
	jsr     swapstk
	jsr     tosaddax
	sta     ptr1
	stx     ptr1+1
	lda     #$00
	clc
	adc     ptr1
	pha
	lda     #$04
	adc     ptr1+1
	tax
	pla
	jsr     pushax
	lda     _minerData
	ldx     _minerData+1
	jsr     pushax
	ldx     #$00
	lda     #$08
	jsr     _memcpy
	jmp     incsp2

.endproc

; ---------------------------------------------------------------
; void __near__ repaintMiner (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_repaintMiner: near

.segment	"CODE"

	ldx     #$00
	lda     _minerY
	jsr     aslax3
	ldy     #$20
	jsr     incaxy
	jsr     pushax
	lda     #<(_CLM_DATA_PMGAREA)
	ldx     #>(_CLM_DATA_PMGAREA)
	jsr     swapstk
	jsr     tosaddax
	sta     ptr1
	stx     ptr1+1
	lda     #$00
	clc
	adc     ptr1
	pha
	lda     #$04
	adc     ptr1+1
	tax
	pla
	jsr     pushax
	lda     _minerData
	ldx     _minerData+1
	jsr     pushax
	ldx     #$00
	lda     #$08
	jmp     _memcpy

.endproc

; ---------------------------------------------------------------
; void __near__ delay (unsigned int)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_delay: near

.segment	"CODE"

	jsr     push0
L08D7:	jsr     stax0sp
	ldy     #$02
	cmp     (sp),y
	txa
	iny
	sbc     (sp),y
	bcs     L04DA
	lda     $0014
	jsr     pusha
	ldy     #$00
L08D6:	lda     (sp),y
	cmp     $0014
	beq     L08D6
	jsr     incsp1
	jsr     ldax0sp
	jsr     incax1
	jmp     L08D7
L04DA:	jmp     incsp4

.endproc

; ---------------------------------------------------------------
; void __near__ adjustGameSpeed (unsigned char, unsigned char)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_adjustGameSpeed: near

.segment	"CODE"

	ldy     #$01
	lda     (sp),y
	bne     L06C3
	dey
	lda     (sp),y
	cmp     #$01
	bne     L08D9
	lda     #$0E
	sta     _brokenSpeed
	lda     #$05
	sta     _hijumpSpeedA
	lda     #$11
	sta     _hijumpSpeedB
	lda     #$07
	sta     _controlDelay
	lda     #$03
	jmp     L08D8
L08D9:	lda     #$11
	sta     _brokenSpeed
	lda     #$06
	sta     _hijumpSpeedA
	lda     #$14
	sta     _hijumpSpeedB
	lda     #$09
	sta     _controlDelay
	lda     #$04
	jmp     L08D8
L06C3:	dey
	lda     (sp),y
	cmp     #$01
	bne     L08DA
	lda     #$15
	sta     _brokenSpeed
	lda     #$07
	sta     _hijumpSpeedA
	lda     #$16
	sta     _hijumpSpeedB
	lda     #$0C
	sta     _controlDelay
	lda     #$04
	jmp     L08D8
L08DA:	lda     #$19
	sta     _brokenSpeed
	lda     #$08
	sta     _hijumpSpeedA
	lda     #$1A
	sta     _hijumpSpeedB
	lda     #$0F
	sta     _controlDelay
	lda     #$05
L08D8:	sta     _fallSpeed
	jmp     incsp2

.endproc

; ---------------------------------------------------------------
; void __near__ displayCongratulations (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_displayCongratulations: near

.segment	"CODE"

	lda     #$00
	sta     $022F
	lda     _menuDl1
	sta     $0230
	lda     _menuDl2
	sta     $0231
	jsr     _clrscr
	lda     #$02
	jsr     pusha
	lda     #$04
	jsr     pusha
	lda     #<(L0711)
	ldx     #>(L0711)
	jsr     _cputsxy
	lda     #$02
	jsr     pusha
	lda     #$06
	jsr     pusha
	lda     #<(L0716)
	ldx     #>(L0716)
	jsr     _cputsxy
	lda     #$02
	jsr     pusha
	lda     #$07
	jsr     pusha
	lda     #<(L071B)
	ldx     #>(L071B)
	jsr     _cputsxy
	lda     #$02
	jsr     pusha
	lda     #$0B
	jsr     pusha
	lda     #<(L0720)
	ldx     #>(L0720)
	jsr     _cputsxy
	lda     #$02
	jsr     pusha
	lda     #$0C
	jsr     pusha
	lda     #<(L0725)
	ldx     #>(L0725)
	jsr     _cputsxy
	jsr     _setTextModeSettings
	lda     #$3E
	sta     $022F
	lda     #$32
	jsr     pusha0
	jsr     _delay
	lda     #$00
	sta     _x1
L08DB:	lda     _x1
	cmp     #$03
	bcs     L08DC
	lda     #$10
	jsr     pusha
	jsr     _playSFX
	lda     #$32
	jsr     pusha0
	jsr     _delay
	inc     _x1
	jmp     L08DB
L08DC:	lda     #$64
	jsr     pusha0
	jsr     _delay
	lda     #$02
	jsr     pusha
	lda     #$14
	jsr     pusha
	lda     #<(L0742)
	ldx     #>(L0742)
	jsr     _cputsxy
	lda     #$01
	jsr     _revers
	lda     #$08
	jsr     pusha
	lda     #$14
	jsr     pusha
	lda     #<(L0749)
	ldx     #>(L0749)
	jsr     _cputsxy
	lda     #$00
	jsr     _revers
	lda     #$0D
	jsr     pusha
	lda     #$14
	jsr     pusha
	lda     #<(L0750)
	ldx     #>(L0750)
	jsr     _cputsxy
	lda     #$0A
	jsr     pusha0
	jsr     _delay
L0754:	lda     $0284
	bne     L0754
	rts

.endproc

; ---------------------------------------------------------------
; void __near__ displayGameOver (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_displayGameOver: near

.segment	"CODE"

	lda     #$00
	sta     $022F
	lda     _menuDl1
	sta     $0230
	lda     _menuDl2
	sta     $0231
	jsr     _clrscr
	lda     #$0E
	jsr     pusha
	lda     #$0B
	jsr     pusha
	lda     #<(L076E)
	ldx     #>(L076E)
	jsr     _cputsxy
	jsr     _setTextModeSettings
	lda     #$3E
	sta     $022F
	lda     #$96
	jsr     pusha0
	jsr     _delay
	lda     #$09
	jsr     pusha
	lda     #$0D
	jsr     pusha
	lda     #<(L077C)
	ldx     #>(L077C)
	jsr     _cputsxy
	lda     #$01
	jsr     _revers
	lda     #$0F
	jsr     pusha
	lda     #$0D
	jsr     pusha
	lda     #<(L0783)
	ldx     #>(L0783)
	jsr     _cputsxy
	lda     #$00
	jsr     _revers
	lda     #$14
	jsr     pusha
	lda     #$0D
	jsr     pusha
	lda     #<(L078A)
	ldx     #>(L078A)
	jsr     _cputsxy
L078C:	lda     $0284
	bne     L078C
	rts

.endproc

; ---------------------------------------------------------------
; void __near__ displayReturnToMenuScreen (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_displayReturnToMenuScreen: near

.segment	"CODE"

	lda     #$00
	sta     $022F
	lda     _menuDl1
	sta     $0230
	lda     _menuDl2
	sta     $0231
	jsr     _clrscr
	lda     #$05
	jsr     pusha
	lda     #$0A
	jsr     pusha
	lda     #<(L07A6)
	ldx     #>(L07A6)
	jsr     _cputsxy
	jsr     _setTextModeSettings
	lda     #$3E
	sta     $022F
	lda     #$7D
	jsr     pusha0
	jmp     _delay

.endproc

; ---------------------------------------------------------------
; void __near__ setTextModeSettings (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_setTextModeSettings: near

.segment	"CODE"

	lda     #$0E
	sta     $02C5
	jsr     _get_tv
	cmp     #$01
	bne     L086D
	lda     #$30
	jmp     L08DD
L086D:	lda     #$32
L08DD:	sta     $02C6
	lda     #$E0
	sta     $02F4
	rts

.endproc

; ---------------------------------------------------------------
; void __near__ displayMainMenu (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_displayMainMenu: near

.segment	"CODE"

	jsr     decsp1
	lda     #$00
	sta     $022F
	lda     _menuDl1
	sta     $0230
	lda     _menuDl2
	sta     $0231
	jsr     _setTextModeSettings
	jsr     _clrscr
	lda     #$00
	jsr     _cursor
	lda     #$01
	jsr     _revers
	lda     #$01
	jsr     pusha
	jsr     pusha
	lda     #<(L0631)
	ldx     #>(L0631)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$02
	jsr     pusha
	lda     #<(L0636)
	ldx     #>(L0636)
	jsr     _cputsxy
	lda     #$00
	jsr     _revers
	lda     #$01
	ldy     #$00
L08E0:	sta     (sp),y
	cmp     #$27
	bcs     L063B
	lda     (sp),y
	jsr     pusha
	lda     #$00
	jsr     pusha
	lda     #$12
	jsr     _cputcxy
	ldy     #$00
	lda     (sp),y
	jsr     pusha
	lda     #$03
	jsr     pusha
	lda     #$12
	jsr     _cputcxy
	ldy     #$00
	lda     (sp),y
	jsr     pusha
	lda     #$16
	jsr     pusha
	lda     #$12
	jsr     _cputcxy
	ldy     #$00
	lda     (sp),y
	jsr     pusha
	lda     #$12
	jsr     pusha
	jsr     _cputcxy
	ldy     #$00
	lda     (sp),y
	jsr     pusha
	lda     #$0A
	jsr     pusha
	lda     #$12
	jsr     _cputcxy
	ldy     #$00
	lda     (sp),y
	clc
	adc     #$01
	jmp     L08E0
L063B:	lda     #$02
	jsr     pusha
	lda     #$13
	jsr     pusha
	lda     #<(L0659)
	ldx     #>(L0659)
	jsr     _cputsxy
	lda     #$02
	jsr     pusha
	lda     #$14
	jsr     pusha
	lda     #<(L065E)
	ldx     #>(L065E)
	jsr     _cputsxy
	lda     #$02
	jsr     pusha
	lda     #$15
	jsr     pusha
	lda     #<(L0663)
	ldx     #>(L0663)
	jsr     _cputsxy
	lda     #$23
	jsr     pusha
	lda     #$15
	jsr     pusha
	lda     #<(L0668)
	ldx     #>(L0668)
	jsr     _cputsxy
	lda     #$02
	jsr     pusha
	lda     #$08
	jsr     pusha
	lda     #<(L066D)
	ldx     #>(L066D)
	jsr     _cputsxy
	lda     #$0D
	jsr     pusha
	lda     #$08
	jsr     pusha
	lda     #<(L0672)
	ldx     #>(L0672)
	jsr     _cputsxy
	lda     #$01
	jsr     _revers
	lda     #$08
	jsr     pusha
	jsr     pusha
	lda     #<(L0679)
	ldx     #>(L0679)
	jsr     _cputsxy
	lda     #$00
	jsr     _revers
	lda     #$02
	jsr     pusha
	lda     #$0C
	jsr     pusha
	lda     #<(L0680)
	ldx     #>(L0680)
	jsr     _cputsxy
	lda     #$05
	jsr     pusha
	lda     #$0C
	jsr     pusha
	lda     #$1E
	jsr     _cputcxy
	lda     #$06
	jsr     pusha
	lda     #$0C
	jsr     pusha
	lda     #$1F
	jsr     _cputcxy
	lda     #$08
	jsr     pusha
	lda     #$0C
	jsr     pusha
	lda     #<(L068D)
	ldx     #>(L068D)
	jsr     _cputsxy
	lda     #$02
	jsr     pusha
	lda     #$0D
	jsr     pusha
	lda     #<(L0692)
	ldx     #>(L0692)
	jsr     _cputsxy
	lda     #$05
	jsr     pusha
	lda     #$0D
	jsr     pusha
	lda     #$1D
	jsr     _cputcxy
	lda     #$08
	jsr     pusha
	lda     #$0D
	jsr     pusha
	lda     #<(L069B)
	ldx     #>(L069B)
	jsr     _cputsxy
	lda     #$02
	jsr     pusha
	lda     #$0E
	jsr     pusha
	lda     #<(L06A0)
	ldx     #>(L06A0)
	jsr     _cputsxy
	lda     #$05
	jsr     pusha
	lda     #$0E
	jsr     pusha
	lda     #$1C
	jsr     _cputcxy
	lda     #$08
	jsr     pusha
	lda     #$0E
	jsr     pusha
	lda     #<(L06A9)
	ldx     #>(L06A9)
	jsr     _cputsxy
	jsr     _displayStartingCave
	jsr     _displayGameSpeed
	lda     #$3E
	sta     $022F
	jmp     incsp1

.endproc

; ---------------------------------------------------------------
; void __near__ displayTrainingText (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_displayTrainingText: near

.segment	"CODE"

	jsr     _clrscr
	lda     #$F8
	jsr     pusha
	lda     #$20
	jsr     pusha
	jsr     _setMinerPos
	lda     #$01
	jsr     pusha
	jsr     pusha
	lda     #<(L07B9)
	ldx     #>(L07B9)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$02
	jsr     pusha
	lda     #<(L07BE)
	ldx     #>(L07BE)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$04
	jsr     pusha
	lda     #<(L07C3)
	ldx     #>(L07C3)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$05
	jsr     pusha
	lda     #<(L07C8)
	ldx     #>(L07C8)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$06
	jsr     pusha
	lda     #<(L07CD)
	ldx     #>(L07CD)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$07
	jsr     pusha
	lda     #<(L07D2)
	ldx     #>(L07D2)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$09
	jsr     pusha
	lda     #<(L07D7)
	ldx     #>(L07D7)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$0A
	jsr     pusha
	lda     #<(L07DC)
	ldx     #>(L07DC)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$0B
	jsr     pusha
	lda     #<(L07E1)
	ldx     #>(L07E1)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$0D
	jsr     pusha
	lda     #<(L07E6)
	ldx     #>(L07E6)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$0E
	jsr     pusha
	lda     #<(L07EB)
	ldx     #>(L07EB)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$10
	jsr     pusha
	lda     #<(L07F0)
	ldx     #>(L07F0)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$11
	jsr     pusha
	lda     #<(L07F5)
	ldx     #>(L07F5)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$17
	jsr     pusha
	lda     #<(L07FA)
	ldx     #>(L07FA)
	jsr     _cputsxy
	lda     #$01
	jsr     _revers
	lda     #$07
	jsr     pusha
	lda     #$17
	jsr     pusha
	lda     #<(L0801)
	ldx     #>(L0801)
	jsr     _cputsxy
	lda     #$00
	jsr     _revers
	lda     #$0C
	jsr     pusha
	lda     #$17
	jsr     pusha
	lda     #<(L0808)
	ldx     #>(L0808)
	jsr     _cputsxy
L080A:	lda     $0284
	bne     L080A
	jsr     _clrscr
	lda     #$01
	jsr     pusha
	jsr     pusha
	lda     #<(L0814)
	ldx     #>(L0814)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$02
	jsr     pusha
	lda     #<(L0819)
	ldx     #>(L0819)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$04
	jsr     pusha
	lda     #<(L081E)
	ldx     #>(L081E)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$05
	jsr     pusha
	lda     #<(L0823)
	ldx     #>(L0823)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$07
	jsr     pusha
	lda     #<(L0828)
	ldx     #>(L0828)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$08
	jsr     pusha
	lda     #<(L082D)
	ldx     #>(L082D)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$09
	jsr     pusha
	lda     #<(L0832)
	ldx     #>(L0832)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$0B
	jsr     pusha
	lda     #<(L0837)
	ldx     #>(L0837)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$0C
	jsr     pusha
	lda     #<(L083C)
	ldx     #>(L083C)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$11
	jsr     pusha
	lda     #<(L0841)
	ldx     #>(L0841)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$12
	jsr     pusha
	lda     #<(L0846)
	ldx     #>(L0846)
	jsr     _cputsxy
	lda     #$01
	jsr     pusha
	lda     #$17
	jsr     pusha
	lda     #<(L084B)
	ldx     #>(L084B)
	jsr     _cputsxy
	lda     #$01
	jsr     _revers
	lda     #$07
	jsr     pusha
	lda     #$17
	jsr     pusha
	lda     #<(L0852)
	ldx     #>(L0852)
	jsr     _cputsxy
	lda     #$00
	jsr     _revers
	lda     #$0C
	jsr     pusha
	lda     #$17
	jsr     pusha
	lda     #<(L0859)
	ldx     #>(L0859)
	jsr     _cputsxy
L08E1:	lda     $0284
	beq     L08E1
L0861:	lda     $0284
	bne     L0861
	rts

.endproc

; ---------------------------------------------------------------
; void __near__ displayGameSpeed (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_displayGameSpeed: near

.segment	"CODE"

	lda     _gameSpeed
	bne     L06B4
	lda     #$20
	jsr     pusha
	lda     #$0D
	jsr     pusha
	lda     #<(L06BA)
	ldx     #>(L06BA)
	jmp     _cputsxy
L06B4:	lda     #$20
	jsr     pusha
	lda     #$0D
	jsr     pusha
	lda     #<(L06C0)
	ldx     #>(L06C0)
	jmp     _cputsxy

.endproc

; ---------------------------------------------------------------
; void __near__ displayStartingCave (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_displayStartingCave: near

.segment	"CODE"

	lda     #$24
	jsr     pusha
	lda     #$0C
	jsr     _gotoxy
	lda     #<(L06FA)
	ldx     #>(L06FA)
	jsr     pushax
	ldx     #$00
	lda     _startingCave
	jsr     incax1
	jsr     pushax
	ldy     #$04
	jmp     _cprintf

.endproc

; ---------------------------------------------------------------
; void __near__ playSongLine (unsigned char)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_playSongLine: near

.segment	"CODE"

	ldy     #$00
	lda     (sp),y
	sta     _songLine
	jsr     _rmtPlaySongLine
	jmp     incsp1

.endproc

; ---------------------------------------------------------------
; void __near__ playSFX (unsigned char)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_playSFX: near

.segment	"CODE"

	ldy     #$00
	lda     (sp),y
	sta     _requestedSFXCode
	jsr     _rmtPlaySFX
	jmp     incsp1

.endproc

; ---------------------------------------------------------------
; unsigned char __near__ moveLeft (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_moveLeft: near

.segment	"CODE"

	lda     _minerX
	beq     L08E3
	ldx     #$00
	lda     _minerX
	jsr     decax1
	jsr     pushax
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveElements)
	sta     ptr1
	txa
	adc     #>(_caveElements)
	sta     ptr1+1
	ldy     _minerY
	lda     (ptr1),y
	sta     ptr1
	lda     #$00
	clc
	adc     #>(_passable)
	sta     ptr1+1
	ldy     #<(_passable)
	lda     (ptr1),y
	bne     L08E4
L08E3:	tax
	rts
L08E4:	dec     _minerX
	lda     _minerX
	jsr     pusha
	lda     _minerY
	jsr     pusha
	jsr     _setMinerPos
	jsr     _checkTreasure
	lda     _controlDelay
	sta     _mvDelay
	ldx     #$00
	lda     #$01
	rts

.endproc

; ---------------------------------------------------------------
; unsigned char __near__ moveRight (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_moveRight: near

.segment	"CODE"

	lda     _minerX
	cmp     #$13
	beq     L08E6
	ldx     #$00
	lda     _minerX
	jsr     incax1
	jsr     pushax
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveElements)
	sta     ptr1
	txa
	adc     #>(_caveElements)
	sta     ptr1+1
	ldy     _minerY
	lda     (ptr1),y
	sta     ptr1
	lda     #$00
	clc
	adc     #>(_passable)
	sta     ptr1+1
	ldy     #<(_passable)
	lda     (ptr1),y
	bne     L08E7
L08E6:	ldx     #$00
	txa
	rts
L08E7:	inc     _minerX
	lda     _minerX
	jsr     pusha
	lda     _minerY
	jsr     pusha
	jsr     _setMinerPos
	jsr     _checkTreasure
	lda     _controlDelay
	sta     _mvDelay
	ldx     #$00
	lda     #$01
	rts

.endproc

; ---------------------------------------------------------------
; void __near__ moveUp (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_moveUp: near

.segment	"CODE"

	lda     _minerY
	bne     L08EA
	rts
L08EA:	lda     _minerX
	jsr     pusha0
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveElements)
	sta     ptr1
	txa
	adc     #>(_caveElements)
	sta     ptr1+1
	ldx     #$00
	lda     _minerY
	jsr     decax1
	clc
	adc     ptr1
	sta     ptr1
	txa
	adc     ptr1+1
	sta     ptr1+1
	ldy     #$00
	lda     (ptr1),y
	sta     _x1
	ldy     _x1
	lda     _passable,y
	beq     L0537
	lda     _minerX
	jsr     pusha0
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveElements)
	sta     ptr1
	txa
	adc     #>(_caveElements)
	sta     ptr1+1
	ldy     _minerY
	lda     (ptr1),y
	cmp     #$07
	bne     L0537
	lda     _x1
	cmp     #$09
	bne     L08E9
	lda     #$00
	sta     _stayHere
	lda     #$01
	sta     _caveDeath
	rts
L08E9:	dec     _minerY
	lda     _minerX
	jsr     pusha
	lda     _minerY
	jsr     pusha
	jsr     _setMinerPos
	jsr     _checkTreasure
	lda     _controlDelay
	sta     _mvDelay
L0537:	rts

.endproc

; ---------------------------------------------------------------
; void __near__ moveDown (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_moveDown: near

.segment	"CODE"

	lda     _minerY
	cmp     #$15
	beq     L0511
	lda     _minerX
	jsr     pusha0
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveElements)
	sta     ptr1
	txa
	adc     #>(_caveElements)
	sta     ptr1+1
	ldx     #$00
	lda     _minerY
	jsr     incax1
	clc
	adc     ptr1
	sta     ptr1
	txa
	adc     ptr1+1
	sta     ptr1+1
	ldy     #$00
	lda     (ptr1),y
	sta     _x1
	ldy     _x1
	lda     _passable,y
	cmp     #$01
	bne     L0511
	inc     _minerY
	lda     _minerX
	jsr     pusha
	lda     _minerY
	jsr     pusha
	jsr     _setMinerPos
	jsr     _checkTreasure
	lda     _controlDelay
	sta     _mvDelay
L0511:	rts

.endproc

; ---------------------------------------------------------------
; unsigned char __near__ jumpUp (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_jumpUp: near

.segment	"CODE"

	ldx     #$00
	lda     _minerY
	beq     L08EE
	lda     _minerX
	jsr     pusha0
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveElements)
	sta     ptr1
	txa
	adc     #>(_caveElements)
	sta     ptr1+1
	ldx     #$00
	lda     _minerY
	jsr     decax1
	clc
	adc     ptr1
	sta     ptr1
	txa
	adc     ptr1+1
	sta     ptr1+1
	ldy     #$00
	lda     (ptr1),y
	sta     _x1
	cmp     #$09
	bne     L0552
	sty     _stayHere
	lda     #$01
	sta     _caveDeath
	ldx     #$00
	rts
L0552:	ldy     _x1
	lda     _passable,y
	bne     L08ED
	tax
	rts
L08ED:	dec     _minerY
	lda     _minerX
	jsr     pusha
	lda     _minerY
	jsr     pusha
	jsr     _setMinerPos
	jsr     _checkTreasure
	ldx     #$00
	txa
L08EE:	rts

.endproc

; ---------------------------------------------------------------
; void __near__ fallDown (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_fallDown: near

.segment	"CODE"

	lda     _minerY
	cmp     #$15
	beq     L0523
	lda     _minerX
	jsr     pusha0
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveElements)
	sta     ptr1
	txa
	adc     #>(_caveElements)
	sta     ptr1+1
	ldx     #$00
	lda     _minerY
	jsr     incax1
	clc
	adc     ptr1
	sta     ptr1
	txa
	adc     ptr1+1
	sta     ptr1+1
	ldy     #$00
	lda     (ptr1),y
	sta     _x1
	ldy     _x1
	lda     _passable,y
	cmp     #$01
	bne     L0523
	inc     _minerY
	lda     _minerX
	jsr     pusha
	lda     _minerY
	jsr     pusha
	jsr     _setMinerPos
	jmp     _checkTreasure
L0523:	rts

.endproc

; ---------------------------------------------------------------
; void __near__ handleHighJump (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_handleHighJump: near

.segment	"CODE"

	lda     _hijumpSpeedA
	jsr     pusha
	lda     #$00
	jsr     pusha
	jsr     decsp1
	lda     #>(_minerDataJump)
	sta     _minerData+1
	lda     #<(_minerDataJump)
	sta     _minerData
	lda     #$00
	sta     _y1
	lda     #$03
	sta     _hiJump
	lda     #$00
	sta     _mvDelay
	jmp     L08F3
L0570:	jsr     _jumpUp
	tax
	beq     L05A2
	jmp     L0571
L08F0:	lda     _mvDelay
	bne     L0582
	lda     $0278
	sta     _hijs
	cmp     #$06
	beq     L0594
	cmp     #$07
	beq     L0594
	cmp     #$0A
	beq     L0586
	cmp     #$0B
	bne     L08F1
L0586:	lda     _y1
	bne     L0582
	jsr     _moveLeft
	tax
	beq     L0582
	lda     #$01
	sta     _y1
	jmp     L0582
L0594:	lda     _y1
	bne     L0582
	jsr     _moveRight
	tax
	beq     L0582
	lda     #$01
	sta     _y1
	jmp     L0582
L08F1:	lda     #$00
	sta     _mvDelay
L0582:	ldy     #$00
	lda     (sp),y
	cmp     $0014
	beq     L05A2
	lda     $0014
	sta     (sp),y
	iny
	lda     (sp),y
	clc
	adc     #$01
	sta     (sp),y
L05A2:	ldy     #$01
	lda     (sp),y
	iny
	cmp     (sp),y
	bcc     L08F0
	lda     _hiJump
	cmp     #$02
	bne     L08F2
	lda     _hijumpSpeedB
	sta     (sp),y
L08F2:	lda     #$00
	dey
	sta     (sp),y
	dec     _hiJump
L08F3:	lda     _hiJump
	jne     L0570
L0571:	jsr     _checkDeath
	lda     #>(_minerDataNormal)
	sta     _minerData+1
	lda     #<(_minerDataNormal)
	sta     _minerData
	jsr     _repaintMiner
	jmp     incsp3

.endproc

; ---------------------------------------------------------------
; void __near__ updateStatusBar (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_updateStatusBar: near

.segment	"CODE"

	lda     #>(_CLM_DATA_STATUSBARSCREEN)
	sta     ptr1+1
	lda     #<(_CLM_DATA_STATUSBARSCREEN)
	sta     ptr1
	lda     #$00
	ldy     #$27
L08F4:	sta     (ptr1),y
	dey
	bpl     L08F4
	lda     #$00
	sta     _y1
	tax
L08F5:	lda     _y1
	cmp     _lives
	bcs     L08F6
	clc
	adc     #<(_CLM_DATA_STATUSBARSCREEN)
	sta     ptr1
	lda     #$00
	adc     #>(_CLM_DATA_STATUSBARSCREEN)
	sta     ptr1+1
	lda     #$7B
	ldy     #$00
	sta     (ptr1),y
	inc     _y1
	jmp     L08F5
L08F6:	lda     _gameType
	cmp     #$01
	bne     L08F7
	lda     #<(_CLM_DATA_STATUSBARSCREEN+32)
	ldx     #>(_CLM_DATA_STATUSBARSCREEN+32)
	jsr     pushax
	lda     #<(_trainingLiteral)
	ldx     #>(_trainingLiteral)
	jsr     pushax
	ldx     #$00
	lda     #$08
	jmp     _memcpy
L08F7:	lda     _currentCave
	ldy     #$1B
	jsr     incaxy
	clc
	adc     #$01
	sta     _x1
	lda     #$1B
	sta     _y1
L08F8:	lda     _y1
	cmp     _x1
	bcs     L0603
	clc
	adc     #<(_CLM_DATA_STATUSBARSCREEN)
	sta     ptr1
	lda     #$00
	adc     #>(_CLM_DATA_STATUSBARSCREEN)
	sta     ptr1+1
	lda     #$60
	ldy     #$00
	sta     (ptr1),y
	inc     _y1
	jmp     L08F8
L0603:	rts

.endproc

; ---------------------------------------------------------------
; unsigned char __near__ checkTreasure (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_checkTreasure: near

.segment	"CODE"

	lda     _minerX
	jsr     pusha0
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveElements)
	sta     ptr1
	txa
	adc     #>(_caveElements)
	sta     ptr1+1
	ldy     _minerY
	lda     (ptr1),y
	sta     _x1
	cmp     #$0A
	lda     #$00
	tax
	bcc     L0901
	lda     _x1
	cmp     #$0D
	bcc     L08FE
	txa
	rts
L08FE:	inc     _diamondsCollected
	lda     _minerX
	jsr     pusha0
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveElements)
	tay
	txa
	adc     #>(_caveElements)
	tax
	tya
	clc
	adc     _minerY
	bcc     L08FA
	inx
L08FA:	sta     ptr1
	stx     ptr1+1
	lda     #$00
	tay
	sta     (ptr1),y
	lda     _minerX
	jsr     pusha
	lda     _minerY
	jsr     pusha
	lda     #$00
	jsr     pusha
	jsr     _paintElement
	lda     #$0A
	jsr     pusha
	jsr     _playSFX
	ldx     #$00
	lda     _diamondsInCave
	cmp     _diamondsCollected
	bne     L08FF
	stx     _stayHere
	lda     #$01
	sta     _caveAllPicked
L08FF:	lda     #$01
	rts
L0901:	rts

.endproc

; ---------------------------------------------------------------
; void __near__ checkDeath (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_checkDeath: near

.segment	"CODE"

	lda     _minerX
	jsr     pusha0
	lda     #$16
	jsr     tosmula0
	clc
	adc     #<(_caveElements)
	sta     ptr1
	txa
	adc     #>(_caveElements)
	sta     ptr1+1
	ldx     #$00
	lda     _minerY
	jsr     incax1
	clc
	adc     ptr1
	sta     ptr1
	txa
	adc     ptr1+1
	sta     ptr1+1
	ldy     #$00
	lda     (ptr1),y
	sta     _x1
	cmp     #$08
	bne     L05BB
	sty     _stayHere
	lda     #$01
	sta     _caveDeath
L05BB:	rts

.endproc

; ---------------------------------------------------------------
; int __near__ main (void)
; ---------------------------------------------------------------

.segment	"CODE"

.proc	_main: near

.segment	"CODE"

	lda     #$00
	sta     $022F
	lda     #$01
	jsr     pusha0
	jsr     _delay
	lda     #$00
	sta     _gameOverType
	jsr     _clrscr
	lda     #$00
	sta     _maxCaveReached
	sta     _gameSpeed
	lda     #$01
	sta     $0244
	lda     $D01F
	cmp     #$05
	bne     L00A9
	lda     #$0C
	sta     _maxCaveReached
L00A9:	jsr     _rmtSuspend
	jsr     _rmtSetVBI
	lda     $0230
	sta     _menuDl1
	lda     $0231
	sta     _menuDl2
	lda     #$00
	jsr     _cursor
	lda     #$01
	sta     $02DB
	jsr     _pmgInit
L00C2:	lda     #$00
	sta     $022F
	lda     #$02
	jsr     pusha0
	jsr     _delay
	lda     #$60
	sta     $D40E
	lda     #$02
	jsr     pusha0
	jsr     _delay
	lda     #$3E
	sta     $022F
	lda     _gameOverType
	cmp     #$01
	beq     L00DF
	cmp     #$02
	beq     L00E8
	cmp     #$03
	beq     L00F1
	jmp     L00DC
L00DF:	jsr     _rmtSuspend
	lda     #$0E
	jsr     pusha
	jsr     _playSongLine
	jsr     _rmtResume
	jsr     _displayGameOver
	jmp     L00DC
L00E8:	jsr     _rmtSuspend
	lda     #$10
	jsr     pusha
	jsr     _playSongLine
	jsr     _rmtResume
	jsr     _displayCongratulations
	jmp     L00DC
L00F1:	jsr     _rmtSuspend
	lda     #$10
	jsr     pusha
	jsr     _playSongLine
	jsr     _rmtResume
	jsr     _displayReturnToMenuScreen
L00DC:	jsr     _rmtSuspend
	lda     #$00
	jsr     pusha
	jsr     _playSongLine
	jsr     _rmtResume
	lda     #$01
	jsr     pusha
	lda     #$06
	jsr     pusha
	jsr     _setMinerPos
	jsr     _displayMainMenu
	jsr     _kbhit
	tax
	beq     L0903
	jsr     _cgetc
L0903:	lda     $0284
	beq     L0903
	lda     $0278
	cmp     #$0F
	bne     L0903
L0905:	lda     $0284
	bne     L0906
	sta     $004D
	sta     _gameType
	jmp     L090B
L0906:	lda     $0278
	cmp     #$07
	bne     L0907
	lda     _startingCave
	cmp     _maxCaveReached
	bcs     L0907
	inc     _startingCave
	jsr     _displayStartingCave
	lda     #$0A
	jsr     pusha0
	jsr     _delay
	jmp     L0905
L0907:	lda     $0278
	cmp     #$0B
	bne     L0908
	lda     _startingCave
	beq     L0908
	dec     _startingCave
	jsr     _displayStartingCave
	lda     #$0A
	jsr     pusha0
	jsr     _delay
	jmp     L0905
L0908:	lda     $0278
	cmp     #$0D
	bne     L0909
	lda     #$01
	sec
	sbc     _gameSpeed
	sta     _gameSpeed
	jsr     _displayGameSpeed
	lda     #$0A
	jsr     pusha0
	jsr     _delay
	jmp     L0905
L0909:	lda     $0278
	cmp     #$0E
	bne     L013E
	lda     #$00
	sta     $004D
	jsr     _displayTrainingText
	lda     #$01
	sta     _gameType
	jmp     L090A
L013E:	jsr     _kbhit
	tax
	jeq     L0905
	jsr     _cgetc
	sta     _x1
	cmp     #$1B
	jne     L0905
	jsr     _rmtAllStop
	jsr     _rmtRestoreVBI
	jsr     _asmReboot
	ldx     #$00
	txa
	rts
L090A:	lda     #$00
L090B:	sta     _gameOverType
	lda     _gameSpeed
	jsr     pusha
	jsr     _get_tv
	jsr     pusha
	jsr     _adjustGameSpeed
	jsr     _rmtSuspend
	jsr     _rmtAllStop
	lda     #$0B
	jsr     pusha
	jsr     _playSongLine
	jsr     _rmtResume
	jsr     _doGame
	jmp     L00C2

.endproc

